<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSC-FinOps</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div id="app">
        <!-- Login Screen (shown when not authenticated) -->
        <div id="login-screen" class="screen">
            <div class="login-container">
                <h1>OSC-FinOps</h1>
                <p class="subtitle">Financial Operations for Outscale</p>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="access-key">Access Key</label>
                        <input type="text" id="access-key" name="access_key" required autocomplete="off">
                    </div>
                    
                    <div class="form-group">
                        <label for="secret-key">Secret Key</label>
                        <input type="password" id="secret-key" name="secret_key" required autocomplete="off">
                    </div>
                    
                    <div class="form-group">
                        <label for="region">Region <span class="required">*</span></label>
                        <select id="region" name="region" required>
                            <option value="">Select a region...</option>
                            <option value="cloudgouv-eu-west-1">cloudgouv-eu-west-1</option>
                            <option value="eu-west-2">eu-west-2</option>
                            <option value="us-west-1">us-west-1</option>
                            <option value="us-east-2">us-east-2</option>
                        </select>
                        <small class="help-text">Credentials will be validated for the selected region</small>
                    </div>
                    
                    <div id="login-error" class="error-message" style="display: none;"></div>
                    
                    <button type="submit" id="login-button" class="btn btn-primary">
                        <span id="login-button-text">Login</span>
                        <span id="login-button-spinner" class="spinner" style="display: none;"></span>
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Main Application (shown when authenticated) -->
        <div id="main-app" class="screen" style="display: none;">
            <header class="app-header">
                <h1>OSC-FinOps</h1>
                <div class="header-actions">
                    <span id="session-info" class="session-info"></span>
                    <button id="logout-button" class="btn btn-secondary">Logout</button>
                </div>
            </header>
            
            <nav class="tab-navigation">
                <button class="tab-button active" data-tab="quotes">Quotes</button>
                <button class="tab-button" data-tab="consumption">Consumption</button>
                <button class="tab-button" data-tab="cost">Cost</button>
                <button class="tab-button" data-tab="trends">Trends</button>
                <button class="tab-button" data-tab="budgets">Budgets</button>
            </nav>
            
            <main class="main-content">
                <div id="tab-content">
                    <div class="tab-panel active" id="tab-quotes">
                        <div id="quote-loading" class="loading-message" style="display: none;">Loading...</div>
                        <div id="quote-error" class="error-message" style="display: none;"></div>
                        
                        <!-- Quote Selector -->
                        <section class="quote-section">
                            <div class="quote-selector-container">
                                <label for="quote-selector">Current Quote:</label>
                                <select id="quote-selector" class="quote-selector">
                                    <option value="">Loading quotes...</option>
                                </select>
                                <button class="btn btn-small" onclick="QuoteBuilder.showNewQuoteModal()">New Quote</button>
                            </div>
                        </section>
                        
                        <!-- Quote Management Header -->
                        <section class="quote-section">
                            <div class="quote-header">
                                <div class="quote-header-info">
                                    <h2 id="quote-name-display" style="margin: 0; display: inline;">My Quote</h2>
                                    <span id="active-quote-indicator" class="badge badge-active" style="display: none; margin-left: 8px;">Active</span>
                                    <div id="quote-metadata" style="margin-top: 4px;">
                                        <small style="color: #666;"></small>
                                    </div>
                                </div>
                                <div class="quote-header-actions">
                                    <button class="btn btn-small" onclick="QuoteBuilder.showRenameQuoteModal()">Rename</button>
                                    <button class="btn btn-small btn-danger" onclick="QuoteBuilder.showDeleteCurrentQuoteModal()">Delete</button>
                                </div>
                            </div>
                        </section>
                        

                        
                        <!-- Resource Selection -->
                        <section class="quote-section">
                            <h2>Add Resource to Quote</h2>
                            <div class="resource-selection-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="quote-region">Region</label>
                                        <select id="quote-region">
                                            <option value="cloudgouv-eu-west-1">cloudgouv-eu-west-1</option>
                                            <option value="eu-west-2" selected>eu-west-2</option>
                                            <option value="us-west-1">us-west-1</option>
                                            <option value="us-east-2">us-east-2</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="quote-category">Category</label>
                                        <select id="quote-category">
                                            <option value="all" selected>All Categories</option>
                                            <option value="Compute">Compute</option>
                                            <option value="Storage">Storage</option>
                                            <option value="Network">Network</option>
                                            <option value="Licence">Licence</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="quote-resource">Resource</label>
                                        <select id="quote-resource">
                                            <option value="">Select a resource...</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="resource-quantity">Quantity</label>
                                        <input type="number" id="resource-quantity" min="1" value="1" step="1">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>Unit Price</label>
                                        <div id="resource-unit-price" class="unit-price-display">-</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>&nbsp;</label>
                                        <button id="add-resource-btn" class="btn btn-primary" disabled>Add to Quote</button>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Quote Items -->
                        <section class="quote-section">
                            <h2>Quote Items</h2>
                            <div class="table-container">
                                <table class="quote-table">
                                    <thead>
                                        <tr>
                                            <th>Resource Name</th>
                                            <th>Region</th>
                                            <th>Quantity</th>
                                            <th>Unit Price</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="quote-items-body">
                                        <tr>
                                            <td colspan="5" class="empty-message">No items in quote. Add resources to get started.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </section>
                        
                        <!-- Quote Configuration -->
                        <section class="quote-section">
                            <h2>Quote Configuration</h2>
                            <div class="quote-config">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="quote-duration">Duration</label>
                                        <input type="number" id="quote-duration" min="1" value="1" step="1">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="quote-duration-unit">Duration Unit</label>
                                        <select id="quote-duration-unit">
                                            <option value="hours">Hours</option>
                                            <option value="days">Days</option>
                                            <option value="weeks">Weeks</option>
                                            <option value="months" selected>Months</option>
                                            <option value="years">Years</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="quote-global-discount">Global Discount (%)</label>
                                        <input type="number" id="quote-global-discount" min="0" max="100" value="0" step="0.1">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="quote-commitment">Commitment Period</label>
                                        <select id="quote-commitment">
                                            <option value="none" selected>None</option>
                                            <option value="1month">1 Month</option>
                                            <option value="1year">1 Year</option>
                                            <option value="3years">3 Years</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Quote Summary -->
                        <section class="quote-section">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h2 style="margin: 0;">Cost Summary</h2>
                                <button id="export-csv-btn" class="btn btn-secondary" style="display: none;">Export to CSV</button>
                            </div>
                            <div id="quote-summary-content" class="quote-summary-content">
                                <p class="empty-message">Add resources to see cost summary</p>
                            </div>
                        </section>
                        
                        <!-- New Quote Modal -->
                        <div id="new-quote-modal" class="modal" style="display: none;">
                            <div class="modal-overlay" onclick="QuoteBuilder.hideNewQuoteModal()"></div>
                            <div class="modal-content">
                                <h3>Create New Quote</h3>
                                <p>The current quote will be automatically saved with its current name.</p>
                                <div class="form-group">
                                    <label for="new-quote-name-input">Quote Name</label>
                                    <input type="text" id="new-quote-name-input" placeholder="Enter quote name" class="form-input">
                                </div>
                                <div class="modal-actions">
                                    <button class="btn btn-secondary" onclick="QuoteBuilder.hideNewQuoteModal()">Cancel</button>
                                    <button class="btn btn-primary" onclick="QuoteBuilder.createNewQuoteFromModal()">Create</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Rename Quote Modal -->
                        <div id="rename-quote-modal" class="modal" style="display: none;">
                            <div class="modal-overlay" onclick="QuoteBuilder.hideRenameQuoteModal()"></div>
                            <div class="modal-content">
                                <h3>Rename Quote</h3>
                                <p>Are you sure you want to rename this quote?</p>
                                <div class="form-group">
                                    <label for="rename-quote-name-input">New Quote Name</label>
                                    <input type="text" id="rename-quote-name-input" placeholder="Enter new quote name" class="form-input">
                                </div>
                                <div class="modal-actions">
                                    <button class="btn btn-secondary" onclick="QuoteBuilder.hideRenameQuoteModal()">Cancel</button>
                                    <button class="btn btn-primary" onclick="QuoteBuilder.confirmRenameQuote()">Rename</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Delete Current Quote Modal -->
                        <div id="delete-current-quote-modal" class="modal" style="display: none;">
                            <div class="modal-overlay" onclick="QuoteBuilder.hideDeleteCurrentQuoteModal()"></div>
                            <div class="modal-content">
                                <h3>Delete Quote</h3>
                                <p>Are you sure you want to delete "<span id="delete-quote-name-display"></span>"?</p>
                                <p style="color: var(--danger-color); font-weight: bold;">This action cannot be undone.</p>
                                <div class="modal-actions">
                                    <button class="btn btn-secondary" onclick="QuoteBuilder.hideDeleteCurrentQuoteModal()">Cancel</button>
                                    <button class="btn btn-danger" onclick="QuoteBuilder.confirmDeleteCurrentQuote()">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-panel" id="tab-consumption" style="display: none;">
                        <div id="consumption-loading" class="loading-message" style="display: none;">Loading consumption data...</div>
                        <div id="consumption-error" class="error-message" style="display: none;"></div>
                        
                        <!-- Filters Section -->
                        <section class="consumption-section">
                            <h2>Filters</h2>
                            <div class="consumption-filters">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="consumption-from-date">From Date</label>
                                        <input type="date" id="consumption-from-date" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="consumption-to-date">To Date</label>
                                        <input type="date" id="consumption-to-date" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="consumption-granularity">Granularity</label>
                                        <select id="consumption-granularity" class="form-input">
                                            <option value="day">Day</option>
                                            <option value="week">Week</option>
                                            <option value="month">Month</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="consumption-region">Region</label>
                                        <select id="consumption-region" class="form-input">
                                            <option value="">All Regions</option>
                                            <option value="cloudgouv-eu-west-1">cloudgouv-eu-west-1</option>
                                            <option value="eu-west-2">eu-west-2</option>
                                            <option value="us-west-1">us-west-1</option>
                                            <option value="us-east-2">us-east-2</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="consumption-service">Service</label>
                                        <select id="consumption-service" class="form-input">
                                            <option value="">All Services</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="consumption-resource-type">Resource Type</label>
                                        <select id="consumption-resource-type" class="form-input">
                                            <option value="">All Resource Types</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="consumption-aggregate-by">Aggregate By</label>
                                        <select id="consumption-aggregate-by" class="form-input">
                                            <option value="">None</option>
                                            <option value="resource_type">Resource Type</option>
                                            <option value="region">Region</option>
                                            <option value="tag">Tag</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <button id="consumption-apply-filters" class="btn btn-primary">Apply Filters</button>
                                    <button id="consumption-clear-filters" class="btn btn-secondary">Clear Filters</button>
                                    <button id="consumption-export-csv" class="btn btn-secondary">Export CSV</button>
                                    <button id="consumption-export-json" class="btn btn-secondary">Export JSON</button>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Summary Cards -->
                        <section class="consumption-section">
                            <h2>Summary</h2>
                            <div class="summary-cards">
                                <div class="summary-card">
                                    <div class="summary-card-label">Total Cost</div>
                                    <div class="summary-card-value" id="consumption-total-cost">$0.00</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-card-label">Period Count</div>
                                    <div class="summary-card-value" id="consumption-period-count">0</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-card-label">Average Daily Cost</div>
                                    <div class="summary-card-value" id="consumption-avg-daily">$0.00</div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Consumption Table -->
                        <section class="consumption-section">
                            <h2>Consumption Data</h2>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>From Date</th>
                                            <th>To Date</th>
                                            <th>Service</th>
                                            <th>Resource Type</th>
                                            <th>Operation</th>
                                            <th>Value</th>
                                            <th>Unit Price</th>
                                            <th>Total Cost</th>
                                            <th>Region</th>
                                        </tr>
                                    </thead>
                                    <tbody id="consumption-table-body">
                                        <tr>
                                            <td colspan="9" class="empty-message">Select filters and click "Apply Filters" to load consumption data</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </section>
                        
                        <!-- Top Cost Drivers -->
                        <section class="consumption-section">
                            <h2>Top Cost Drivers</h2>
                            <div id="consumption-top-drivers">
                                <p class="empty-message">Load consumption data to see top cost drivers</p>
                            </div>
                        </section>
                    </div>
                    
                    <div class="tab-panel" id="tab-cost" style="display: none;">
                        <h2>Current Cost Evaluation</h2>
                        <p>Current cost evaluation functionality will be implemented in Phase 4.</p>
                    </div>
                    
                    <div class="tab-panel" id="tab-trends" style="display: none;">
                        <h2>Trend Analysis</h2>
                        <p>Trend analysis functionality will be implemented in Phase 5.</p>
                    </div>
                    
                    <div class="tab-panel" id="tab-budgets" style="display: none;">
                        <h2>Budget Management</h2>
                        <p>Budget management functionality will be implemented in Phase 6.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/catalog.js"></script>
    <script src="/js/quote.js"></script>
    <script src="/js/quote-builder.js"></script>
    <script src="/js/consumption.js"></script>
    <script src="/js/consumption-builder.js"></script>
    <script>
        // Initialize quote builder when quotes tab is shown
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for auth to complete, then init quote builder
            // Only init if not already initialized (prevents duplicate event listeners)
            if (document.getElementById('main-app').style.display !== 'none' && !QuoteBuilder.initialized) {
                QuoteBuilder.init();
            }
            
            // Also init when switching to quotes tab (handled by App.switchTab now)
            // Removed duplicate initialization here to prevent multiple event listeners
        });
    </script>
</body>
</html>

